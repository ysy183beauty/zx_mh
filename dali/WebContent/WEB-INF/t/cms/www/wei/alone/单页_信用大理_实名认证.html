<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>实名认证 - ${site.name}</title>
    <meta http-equiv="X-UA-Compatible" content="IE=10"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
    <meta http-equiv="keywords" content=""/>
    <meta http-equiv="description" content=""/>
    [#include "../include/页头顶栏_LINK.html"/]
    <style type="text/css">
        .nav-md{
            box-shadow: 2px 2px #ccc;
        }
        .container{
            max-width:1000px!important;
        }
        font{
            float:none!important;
        }
        .col-md-3{
            padding-left:0px!important;
            padding-right:0px!important;
        }
        input[type=file]{
            border:none!important;
            outline: none!important;
            cursor:pointer;
            width:150px!important;
            height:100px!important;
            position:absolute!important;
            top:0px;
            left:15px;
            z-index: 10;
            font-size:50px!important;
            filter:alpha(opacity=0);
            -moz-opacity:0;
            opacity:0;
            padding:0!important;
        }
        .applyImg{
            width:150px;
            height:100px;
            z-index:5;
            background:url("${resSys}/www/red/img/smrz/add.png") center no-repeat;
            background-size:90px 60px;
            border:1px solid #ccc;
        }
        .addImg{
            z-index:3;
            position:absolute!important;
            top:43px!important;
            left:80px;
            font-size:20px;
        }
        .warn{
            float:left;
            font-size:12px;
            line-height: 12px;
            margin-top:10px;
        }
        .cue{
            font-size:12px;
            padding-top:5px;
            color:#1bbc9b;
            text-align: center;
        }
        .example{
            font-size:12px;
            text-align: center;
            color:#fe6c00;
        }
        .col-md-10{
            overflow:hidden;
        }
        .null{
           color: red;
            font-size:12px;
            clear:both;
        }
        #person,#company{
            padding: 0px !important;
        }

    </style>
</head>
<body>
<div class="wrap">
[#include "../include/页头顶栏.html"/]

<!--内容开始-->
<div class="main">
    <div class="container">
        <!--<div class="title">-->
            <!--<span>当前位置：<a href="/" style="color:#000">首页</a> > 实名认证</span>-->
        <!--</div>-->
        <div class="sit height_auto m-t-md">
            <ul>
                <li>
                    <a id="sy" href="/">首页</a>
                </li>
                <li>&gt;</li>
                <li>
                    <a href="/member/userInfo.jspx">用户中心</a>
                </li>
                <li>&gt;</li>
                <li>
                    实名认证
                </li>
            </ul>
        </div>
        <div class="row">

            <div class="nav-col">
                <ul class="nav nav-tabs">
                    <li role="presentation" >
                        <a href="/member/userInfo.jspx" >账户信息</a>
                    </li>
                    <li role="presentation" >
                        <a href="/member/profile.jspx" class="nav-active">实名认证</a>
                    </li>
                    <li role="presentation" >
                        <a href="/member/pwd.jspx">密码修改</a>
                    </li>
                    <li role="presentation" >
                        <a href="/xyxx/index.jhtml">信用信息</a>
                    </li>
                    <li role="presentation" >
                        <a href="/xybg/index.jhtml" >信用报告</a>
                    </li>
                    <li role="presentation" >
                        <a href="/lsxx/index.jhtml">历史信息</a>
                    </li>
                </ul>

            </div>
            <div class="">
                <div class="height_auto m-t-md" style="width:80%;margin:0 auto;">
                    <div class="modal-header tablist" style="height: 55px;">
                        <ul>
                            <li id="company" style="cursor: pointer;font-size:18px;" >企业实名认证</li>
                            <li id="person" style="cursor: pointer;font-size:18px;">个人实名认证</li>
                        </ul>
                        <!--<span class="glyphicon glyphicon-pencil"-->
                        <!--style="float: right;height: 45px;line-height: 45px;cursor: pointer;width: 30px;"-->
                        <!--onClick="editData();" title="编辑"></span>-->
                    </div>
                    <div class="modal-body">
                        <div id="msg" class="text-center" style="font-size: 18px;"></div>
                        <form class="form-horizontal"  enctype="multipart/form-data" id="authentificationForm"
                              novalidate="novalidate" method="post" action="/member/profile.jspx">
                            <div class="form-group text-center" style="display: none">
                                <div id="successMsg"></div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-3 control-label left_text">登录名</div>
                                <div class="col-md-9">
                                    <div class="col-md-10">
                                        <input id="username" name="username" disabled="disabled" type="text"
                                               class="form-control" onfocus="clearMsg(this)" value="">
                                    </div>
                                    <div class="null" id="loginNameMsg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-3 control-label left_text">认证状态</div>
                                <div class="col-md-9">
                                    <div class="col-md-10" style="width:79%;">
                                        <select id="flag" name="flag" type="text" disabled="disabled" class="form-control" style="width:120%;">
                                            <option value="1" selected="selected">未实名认证</option>
                                            <option value="2">实名认证中</option>
                                            <option value="3">实名认证成功</option>
                                            <option value="4">实名认证失败</option>
                                        </select>
                                    </div>
                                    <div class="null" id="flagMsg">
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="type" name="type" value="">

                            <div class="form-group">
                                <div id="loginUserNameTitle" class="col-md-3 control-label left_text">企业名称<font>*</font>
                                </div>
                                <div class="col-md-9">
                                    <div class="col-md-10">
                                        <input id="realname" name="realname" value="" type="text" class="form-control"
                                               onfocus="clearMsg(this)" onblur="match('realname')">
                                    </div>
                                    <div class="null" id="realnameMsg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-3 control-label left_text">手机号码<font>*</font></div>
                                <div class="col-md-9" id="showmobile">
                                    <div class="col-md-10">
                                        <input type="text" placeholder="请输入您的手机号" class="form-control" maxlength="13"
                                               id="mobile" name="mobile" onfocus="clearMsg(this)" value="" onblur="match('mobile')">
                                    </div>
                                    <div class="null" id="mobileMsg">
                                    </div>
                                </div>
                            </div>
                            <!--<div class="form-group">-->
                                <!--<div class="col-md-3 control-label left_text">校验码<font>*</font></div>-->
                                <!--<div class="col-md-9" id="showmsgcode">-->
                                    <!--<div class="col-md-10">-->
                                        <!--<input type="text" placeholder="手机验证码" class="form-control pull-left yz_input"-->
                                               <!--value=""-->
                                               <!--id="msgcode" name="msgcode" maxlength="10" onfocus="clearMsg(this)">-->
                                        <!--<input class="jy_btn pull-right disabled" type="button" id="sendmsgcode"-->
                                               <!--onClick="sendmsg(this)" value="点击获取" style="width:75px;text-align: center">-->
                                    <!--</div>-->
                                    <!--<div class="null" id="msgcodeMsg">-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                            [#if userExt?? && userExt.flag??]
                            [#if userExt.flag =='4']
                            <div class="form-group">
                                <div class="col-md-3 control-label left_text">认证失败原因</div>
                                <div class="col-md-9">
                                    <div class="col-md-10">
                                    <textarea type="text" id="comment" rows="5" disabled="disabled"
                                              class="form-control">${userExt.failComment!}</textarea>
                                    </div>
                                    <div class="null">
                                    </div>
                                </div>
                            </div>
                            [/#if]
                            [/#if]
                            <div class="form-group">
                                <div id="idCardTitle" class="col-md-3 control-label left_text">工商注册号/社会信用代码<font>*</font></div>
                                <div class="col-md-9">
                                    <div class="col-md-10">
                                        <input id="idCard" name="idCard" type="text" class="form-control"
                                               onfocus="clearMsg(this)" onblur="match('idCard')">
                                    </div>
                                    <div class="null" id="idCardMsg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" id="img4">
                                <div id="busCardImg1Title" class="col-md-3 control-label left_text">营业执照正面照<font>*</font>
                                </div>
                                <div class="col-md-9 " style="">
                                    <div class="col-sm-6" >
                                        <!--<div style="z-index: 1;position:relative">-->
                                            <img id="xmTanImg_4" class="applyImg " src=""/>

                                            <input id="idCardImg4" name="idCardImg4" accept="image/jpeg ,image/png" type="file" unselectable="on"
                                                   class="form-control idCardImg" onchange="xmTanUploadImg(this)" onfocus="clearMsg(this)">
                                        <!--</div>-->
                                        <p class="cue">添加营业执照照片</p>
                                    </div>
                                    <div class="col-sm-6">
                                        <img class="applyImg " src="${resSys}/www/red/img/smrz/example-bus.jpg">
                                        <p class="example">示例</p>
                                    </div>
                                    <div class="null" id="idCardImg4Msg">
                                    </div>
                                    <div class="warn">
                                        <p>证件要求</p>
                                        <p>1、上传清晰的营业执照照片</p>
                                        <p>2、证件需为中国大陆工商局颁发的营业执照，涂改无效</p>
                                        <p>3、照片不超过5M，支持JPG/PNG</p>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" id="img1">
                                <div id="idCardImg1Title" class="col-md-3 control-label left_text">企业法人身份证正面照<font>*</font>
                                </div>
                                <div class="col-md-9">
                                    <div class="col-sm-6">
                                        <img id="xmTanImg_1" class="applyImg" src=""/>
                                        <input id="idCardImg1" name="idCardImg1" accept="image/jpeg ,image/png" type="file" unselectable="on"
                                               class="form-control idCardImg" onchange="xmTanUploadImg(this)" onfocus="clearMsg(this)">
                                        <p class="cue">添加身份证正面照片</p>
                                    </div>
                                    <div class="col-sm-6">
                                        <img class="applyImg" src="${resSys}/www/red/img/smrz/example-per-1.jpg">
                                        <p class="example">示例</p>
                                    </div>
                                    <div class="null" id="idCardImg1Msg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" id="img2">
                                <div id="idCardImg2Title" class="col-md-3 control-label left_text">
                                </div>
                                <div class="col-md-9">
                                    <div class="col-sm-6">
                                        <img id="xmTanImg_2" class="applyImg" src=""/>
                                        <input id="idCardImg2" name="idCardImg2" accept="image/jpeg ,image/png" type="file" unselectable="on"
                                               class="form-control idCardImg" onchange="xmTanUploadImg(this)"  onfocus="clearMsg(this)">
                                        <p class="cue">添加身份证反面照片</p>
                                    </div>
                                    <div class="col-sm-6">
                                        <img class="applyImg" src="${resSys}/www/red/img/smrz/example-per-2.jpg">
                                        <p class="example">示例</p>
                                    </div>
                                    <div class="null"  id="idCardImg2Msg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" id="img3">
                                <div id="idCardImg3Title" class="col-md-3 control-label left_text">
                                </div>
                                <div class="col-md-9">
                                    <div class="col-sm-6">
                                        <img id="xmTanImg_3" class="applyImg" src=""/>
                                        <input id="idCardImg3" name="idCardImg3" accept="image/jpeg ,image/png" type="file" unselectable="on"
                                               class="form-control idCardImg" onchange="xmTanUploadImg(this)" onfocus="clearMsg(this)">
                                        <p class="cue">添加手持身份证照片</p>
                                    </div>
                                    <div class="col-sm-6">
                                        <img class="applyImg" src="${resSys}/www/red/img/smrz/example-per-3.jpg">
                                        <p class="example">示例</p>
                                    </div>
                                    <div class="null"  id="idCardImg3Msg">
                                    </div>
                                    <div class="warn">
                                        <p>证件要求</p>
                                        <p>1、上传清晰的身份证正面、反面、手持身份证照片共3张照片</p>
                                        <p>2、照片不超过5M，支持JPG/PNG</p>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" style="display: none;">
                                <div class="col-md-3 control-label left_text">营业执照正面照</div>
                                <div class="col-md-9">
                                    <img id="img4_sf" type="text" width="400" src="">
                                </div>
                            </div>
                            <div class="form-group" style="display: none;">
                                <div class="col-md-3 control-label left_text">身份证正面照</div>
                                <div class="col-md-9">
                                    <img type="text" id="img1_sf" width="400" src="">
                                </div>
                            </div>
                            <div class="form-group" style="display: none;">
                                <div class="col-md-3 control-label left_text">身份证反面照</div>
                                <div class="col-md-9">
                                    <img id="img2_sf" type="text" width="400" src="">
                                </div>
                            </div>
                            <div class="form-group" style="display: none;">
                                <div class="col-md-3 control-label left_text">手持身份证照</div>
                                <div class="col-md-9">
                                    <img id="img3_sf" type="text" width="400" src="">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-3 control-label left_text">验证码<font>*</font></div>
                                <div class="col-md-9" id="showcode">
                                    <div class="col-md-10">
                                        <input type="text" placeholder="图片验证码" class="form-control pull-left yz_input"
                                               maxlength="6" name="captcha" id="captcha" onfocus="clearMsg(this)">
                                        <div id="yz" class="pull-left"
                                             style="margin-left: -20px;width: 15px;line-height: 34px;height: 34px;"></div>
                                        <div class="pull-left yzm_img m-l-sm">
                                            <img id="guestbookCaptcha" style="cursor: pointer;"
                                                 onclick="this.src='/captcha.svl?d='+new Date()" alt=""
                                                 src="${base}/captcha.svl">
                                        </div>
                                    </div>
                                    <div class="null" id="captchaMsg">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group text-center" style="display: none" id="formMsgTitle">
                                <div id="formMsg"></div>
                            </div>
                            <div class="form-group text-center" style="display: none" id="loading">
                                <img style="margin-left: -100px;" src="${base}/r/cms/www/red/img/loading.gif">
                            </div>
                            <div class="form-group" style="margin-top: 40px;">
                                <div class="col-md-8" style="margin-left:50px;">
                                    <div>
                                        <button type="button" onClick="pushImg();" class="btn_sytle" id="btnsub">立即认证
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
</div>
<!--内容结束-->

[#include "../include/页脚信息栏.html"/]

</body>
<script type="text/javascript">
//    异步确认结果
    function match(name){
        var value=$("#"+name).val();
        var obj={};
        obj[name]=value;
        obj["type"]=type;
        if(type=="person" && name!="realname"){
            $.ajax({
                type: "post",
                url:"/member/check.jspx",
                data:obj,
                async:true,
                success:function(data){
                    $("#"+name+"Msg").html(data.msg);
                },
                error:function (msg) {
                 alert(msg);
                }
            });
        }
        else if(type=="company" && name!="mobile"){
            $.ajax({
                type: "post",
                url:"/member/check.jspx",
                data:obj,
                async:true,
                success:function(data){
                    $("#"+name+"Msg").html(data.msg);
                },
                error:function (msg) {
                   alert(msg);
                }
            });
        }

    }
    //预览图片
    if (typeof FileReader == 'undefined') {
        $("#xmTanDiv").html("<h1>当前浏览器不支持FileReader接口</h1>");
        //使选择控件不可操作
        $("#xdaTanFileImg").attr("disabled", "disabled");
    }
    //选择图片，马上预览
    function xmTanUploadImg(obj) {
        if(obj && obj.files){
            var file = obj.files[0];
        }
        var id=obj.id;
        if(id=="idCardImg4"){
            var img = document.getElementById("xmTanImg_4");
        }
        else if(id=="idCardImg1"){
            var img = document.getElementById("xmTanImg_1");
        }
        else if(id=="idCardImg2"){
            var img = document.getElementById("xmTanImg_2");
        }
        else if(id=="idCardImg3"){
            var img = document.getElementById("xmTanImg_3");
        }
        img.src=" ";
//        console.log(obj);console.log(file);
//        console.log(obj.id);
//        console.log("file.size = " + file.size);  //file.size 单位为byte
        var reader = new FileReader();
        //读取文件过程方法
        reader.onloadstart = function (e) {
//            console.log("开始读取....");
        }
        reader.onprogress = function (e) {
//            console.log("正在读取中....");
        }
        reader.onabort = function (e) {
//            console.log("中断读取....");
        }
        reader.onerror = function (e) {
//            console.log("读取异常....");
        }
        reader.onload = function (e) {
//            console.log("成功读取....");
            img.src = e.target.result;
            //或者 img.src = this.result;  //e.target == this
        }
        reader.readAsDataURL(file)
    }
//    初始化
    $(function () {
        [#if user?? && userExt??]
        //初始化认证状态
        var flag = '${userExt.flag!}';
        if (!flag) {
            flag = "1"
        }
        var type = '${userExt.type!}';
        if(type){
            $("#"+type).addClass("active").siblings().removeClass("active");
            $("#"+type).siblings().css("display","none");
            TypeChange(type);
        }
        $("#username").val('${user.username!}');
        $("#flag").val(flag);
            [#if addSuccess??]
                [#if addSuccess == false]
                    $("#type").val('${userExt.type!}');
                    $("#realname").val('${userExt.realname!}');
                    $("#mobile").val('${userExt.mobile!}');
                    $("#idCard").val('${userExt.idCard!}');
                    TypeChange('${userExt.type!}');
                    $("#formMsg").css("color", "red");
                    $("#formMsg").html('${msg}');
                    $("#formMsg").parent().show();
                [#else]
                    $("#successMsg").css("color", "#28ff28");
                    $("#successMsg").html('${msg}');
                    $("#successMsg").parent().show();
                    if (flag == '2' || flag == '3' || flag == '4') {
                        initPage(flag);
                    }
                    setInterval("hideSuccessMsg()", 3000);
                [/#if]
            [#else]
                if (flag == '2' || flag == '3' || flag == '4') {
                    initPage(flag);
                }
            [/#if]
        [#else]
            location.href = '/yhdl/index.jhtml';
        [/#if]

    });
//选择实名认证用户群体
    function TypeChange(id) {
        $("#company").removeClass("active");
        $("#person").removeClass("active");
        $("#"+id).addClass("active");
        $("#type").val(id);
        if (id == "person") {
            $('#loginUserNameTitle').html("个人姓名<font>*</font>");
            $("#idCardTitle").html("身份证号码<font>*</font>");
            $("#idCardImg1Title").html("身份证正面照<font>*</font>");
            $("#img4").hide();

        } else {
            $('#loginUserNameTitle').html("企业名称<font>*</font>");
            $("#idCardTitle").html("工商注册号<font>*</font>");
            $("#img4").show();
        }
    }

    function hideSuccessMsg() {
        $("#successMsg").parent().hide();
    }

    function editData() {
        var flag = $("#flag").val();
        if (flag == '2') {
            alert("认证中，不允许修改数据");
            return;
        } else if (flag == '3') {
            alert("认证成功，不允许修改数据");
            return;
        }
        //隐藏图片
        $("#img1_sf").parent().parent().hide();
        $("#img2_sf").parent().parent().hide();
        $("#img3_sf").parent().parent().hide();
        $("#img4_sf").parent().parent().hide();
        $("#edit").parent().parent().parent().hide();
        $("#comment").parent().parent().parent().hide();
        //显示图片上传空间和按钮
        //显示短信验证码输入框
        $("#msgcode").parent().parent().parent().show();
        //显示上传图片输入框
        $("#idCardImg1").parent().parent().parent().show();
        //显示图片验证码
        $("#captcha").parent().parent().parent().show();
        //显示按钮
        $("#btnsub").parent().parent().parent().show();

        var type = $("#type").val();
        if (type == 'person') {
            $("#idCardImg2").parent().parent().parent().show();
            $("#idCardImg3").parent().parent().parent().show();
            $("#idCardImg2").removeAttr("disabled");
            $("#idCardImg3").removeAttr("disabled");
        }
        //修改输入框可编辑$("#type").attr("disabled","disabled");
        $("#realname").removeAttr("disabled");
        $("#msgcode").removeAttr("disabled");
        $("#idCard").removeAttr("disabled");
        $("#idCardImg1").removeAttr("disabled");
        $("#mobile").removeAttr("disabled");

    }
    //提交过认证信息的初始化
    function initPage(flag) {
        //初始化用户类型
        var type = '${userExt.type!}';
        if (type == '') {
            type = "company";
        }
        TypeChange(type);
        $("#type").val(type);
        $("#realname").val('${userExt.realname!}');
        $("#mobile").val('${userExt.mobile!}');
        $("#idCard").val('${userExt.idCard!}');
        hideInput();
        initImg(type);
        disableElement();
        var flag = $("#flag").val();
    }
    function hideInput() {
        //隐藏短信验证码输入框
        $("#msgcode").parent().parent().parent().hide();
        //隐藏上传图片输入框
        $("#idCardImg1").parent().parent().parent().hide();
        $("#idCardImg2").parent().parent().parent().hide();
        $("#idCardImg3").parent().parent().parent().hide();
        $("#img4").hide();
        //隐藏图片验证码
        $("#captcha").parent().parent().parent().hide();
        //隐藏按钮
        $("#btnsub").parent().parent().parent().hide();
    }
    function initImg(type) {//不可编辑时获取图片
        var img = "${userExt.idCardImg!}";
        var imgs = img.split(",");
        $("#img1_sf").attr("src", "/r/cms/www/red/upload/${userExt.idCard!}" + imgs[0]);
        $("#img2_sf").attr("src", "/r/cms/www/red/upload/${userExt.idCard!}" + imgs[1]);
        $("#img3_sf").attr("src", "/r/cms/www/red/upload/${userExt.idCard!}" + imgs[2]);
        $("#img1_sf").parent().parent().show();
        $("#img2_sf").parent().parent().show();
        $("#img3_sf").parent().parent().show();
        if (type != "person") {
            $("#img4_sf").attr("src", "/r/cms/www/red/upload/${userExt.idCard!}" + imgs[3]);
            $("#img4_sf").parent().parent().show();
        }
    }
    function    clearMsg(ele) {
        if(ele && $(ele).attr("id")){
            $("#" + $(ele).attr("id") + "Msg").html("");
            $("#formMsg").html("");
        }
    }

    function pushImg() {
        var flag = 0;
        var type = $(".active").eq(0).attr("id");
        var captcha = $("#captcha").val();
        if (!captcha) {
            $("#captchaMsg").html("图片验证码不能为空！");
            flag = flag * 1 + 1;
        }
        var idCard = $("#idCard").val();
        if (!idCard) {
            if (type == "person") {
                $("#idCardMsg").html("身份证号码不能为空！");
                $("#realnameMsg").html("个人姓名不能为空！");
            } else {
                $("#idCardMsg").html("工商注册号不能为空！");
                $("#realnameMsg").html("企业名称不能为空！");
            }

            flag = flag * 1 + 1;
        } else {
            if (type == "person") {
                var checkOk = checkCard(idCard, 'idCardMsg');
                if (checkOk != true) {
                    flag = flag * 1 + 1;
                }
            }
        }

        var username = $("#username").val();
        if (!username) {
            if (type == "person") {
                $("#userNameMsg").html("个人姓名不能为空！");
            } else {
                $("#userNameMsg").html("公司名称不能为空！");
            }

            flag = flag * 1 + 1;
        }

        var phone = $("#mobile").val();
        if (!phone) {
            $("#mobileMsg").html("手机号码不能为空！");
            flag = flag * 1 + 1;
        } else {
            var reg = /^1(3|4|5|7|8)\d{9}$/;
            if (!reg.test(phone)) {
                $("#mobileMsg").html("请正确填写手机号！");
                flag = flag * 1 + 1;
            }
        }

//        var msgcode = $("#msgcode").val();
//        if (!msgcode) {
//            $("#msgcodeMsg").html("短信验证码不能为空！");
//            flag = flag * 1 + 1;
//        }
        var authType = $("#flag").val();
        var img1 = $("#idCardImg1").get(0).files[0];
        var img2 = $("#idCardImg2").get(0).files[0];
        var img3 = $("#idCardImg2").get(0).files[0];
        var img4 = $("#idCardImg4").get(0).files[0];
        if (authType != '4') {
            if (type == "person") {
                if (!img1) {
                    $("#idCardImg1Msg").html("身份证正面照不能为空！");
                    flag = flag * 1 + 1;
                }
                if (!img2) {
                    $("#idCardImg2Msg").html("身份证反面照不能为空！");
                    flag = flag * 1 + 1;
                }

                if (!img3) {
                    $("#idCardImg3Msg").html("手持身份证照不能为空！");
                    flag = flag * 1 + 1;
                }
            } else {
                if (!img1) {
                    $("#idCardImg1Msg").html("企业法人身份证正面照不能为空！");
                    flag = flag * 1 + 1;
                }
                if (!img2) {
                    $("#idCardImg2Msg").html("身份证反面照不能为空！");
                    flag = flag * 1 + 1;
                }

                if (!img3) {
                    $("#idCardImg3Msg").html("手持身份证照不能为空！");
                    flag = flag * 1 + 1;
                }
                if (!img4) {
                    $("#idCardImg4Msg").html("营业执照正面照不能为空！");
                    flag = flag * 1 + 1;

                }
            }
        }
        if (flag > 0) {
            return;
        } else {
            $("#loading").show();
            $("#authentificationForm").submit();
        }
    }

    var goIndexCount = 5;
    function goIndex() {
        goIndexCount = goIndexCount * 1 - 1;
        if (goIndexCount <= 0) {
            location.href = "/";
        } else {
            $("#msg").html("您已经实名认证数据<label style='color:#28ff28'>提交成功</label>,等待管理员审核。" + goIndexCount + "秒后即将跳转<a href='/smrz/index.jhtml' style='color: #337ab7;'>首页</a>");
        }
    }

    function disableElement() {
        $("#type").attr("disabled", "disabled");
        $("#realname").attr("disabled", "disabled");
        $("#mobile").attr("disabled", "disabled");
        $("#msgcode").attr("disabled", "disabled");
        $("#idCard").attr("disabled", "disabled");
        $("#idCardImg1").attr("disabled", "disabled");
        $("#idCardImg2").attr("disabled", "disabled");
        $("#idCardImg2").attr("disabled", "disabled");
    }



    checkCard = function (card, msgId) {
        //是否为空
        if (card === '') {
            $("#" + msgId).html('请输入身份证号，身份证号不能为空');
            return false;
        }
        //校验长度，类型
        if (isCardNo(card) === false) {
            $("#" + msgId).html('您输入的身份证号码不正确，请重新输入');
            return false;
        }
        //检查省份
        if (checkProvince(card) === false) {
            $("#" + msgId).html('您输入的身份证号码不正确,请重新输入');
            return false;
        }
        //校验生日
        if (checkBirthday(card) === false) {
            $("#" + msgId).html('您输入的身份证号码生日不正确,请重新输入');
            return false;
        }
        /**
        //检验位的检测
        if (checkParity(card) === false) {
            $("#" + msgId).html('您的身份证校验位不正确,请重新输入');

            return false;
        }
         */
        return true;
    };
    //检查号码是否符合规范，包括长度，类型
    isCardNo = function (card) {
        //身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X
        var reg = /(^\d{15}$)|(^\d{17}(\d|X)$)/;
        if (reg.test(card) === false) {
            return false;
        }

        return true;
    };
    //取身份证前两位,校验省份
    checkProvince = function (card) {
        var province = card.substr(0, 2);
        var vcity = {
            11: "北京", 12: "天津", 13: "河北", 14: "山西", 15: "内蒙古",
            21: "辽宁", 22: "吉林", 23: "黑龙江", 31: "上海", 32: "江苏",
            33: "浙江", 34: "安徽", 35: "福建", 36: "江西", 37: "山东", 41: "河南",
            42: "湖北", 43: "湖南", 44: "广东", 45: "广西", 46: "海南", 50: "重庆",
            51: "四川", 52: "贵州", 53: "云南", 54: "西藏", 61: "陕西", 62: "甘肃",
            63: "青海", 64: "宁夏", 65: "新疆", 71: "台湾", 81: "香港", 82: "澳门", 91: "国外",
            59: "测试"
        };
        if (vcity[province] == undefined) {
            return false;
        }
        return true;
    };
    //检查生日是否正确
    checkBirthday = function (card) {
        var len = card.length;
        //身份证15位时，次序为省（3位）市（3位）年（2位）月（2位）日（2位）校验位（3位），皆为数字
        if (len == '15') {
            var re_fifteen = /^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;
            var arr_data = card.match(re_fifteen);
            var year = arr_data[2];
            var month = arr_data[3];
            var day = arr_data[4];
            var birthday = new Date('19' + year + '/' + month + '/' + day);
            return verifyBirthday('19' + year, month, day, birthday);
        }
        //身份证18位时，次序为省（3位）市（3位）年（4位）月（2位）日（2位）校验位（4位），校验位末尾可能为X
        if (len == '18') {
            var re_eighteen = /^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;
            var arr_data = card.match(re_eighteen);
            var year = arr_data[2];
            var month = arr_data[3];
            var day = arr_data[4];
            var birthday = new Date(year + '/' + month + '/' + day);
            return verifyBirthday(year, month, day, birthday);
        }
        return false;
    };
    //校验日期
    verifyBirthday = function (year, month, day, birthday) {
        var now = new Date();
        var now_year = now.getFullYear();
        //年月日是否合理
        if (birthday.getFullYear() == year && (birthday.getMonth() + 1) == month && birthday.getDate() == day) {
            //判断年份的范围（3岁到100岁之间)
            var time = now_year - year;
            if (time >= 3 && time <= 100) {
                return true;
            }
            return false;
        }
        return false;
    };
    //校验位的检测
    checkParity = function (card) {
        //15位转18位
        card = changeFivteenToEighteen(card);
        var len = card.length;
        if (len == '18') {
            var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
            var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
            var cardTemp = 0, i, valnum;
            for (i = 0; i < 17; i++) {
                cardTemp += card.substr(i, 1) * arrInt[i];
            }
            valnum = arrCh[cardTemp % 11];
            if (valnum == card.substr(17, 1)) {
                return true;
            }
            return false;
        }
        return false;
    };
    //15位转18位身份证号
    changeFivteenToEighteen = function (card) {
        if (card.length == '15') {
            var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
            var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
            var cardTemp = 0, i;
            card = card.substr(0, 6) + '19' + card.substr(6, card.length - 6);
            for (i = 0; i < 17; i++) {
                cardTemp += card.substr(i, 1) * arrInt[i];
            }
            card += arrCh[cardTemp % 11];
            return card;
        }
        return card;
    };
</script>
</html>
